# every_music
every one, every time, music

---

# ログイン画面
## 画面項目
* MailAddress入力欄（テキストボックス、必須）
* パスワード入力欄（パスワード入力ボックス、必須）
* ログインボタン
* 新規登録ボタン
## 処理
### ログインボタン
1. ボタン押下後、入力内容をServerにリクエスト
2. バリデーションチェック後、memberテーブルの情報と突合
3. 合っていればログイン成功として曲一覧画面に遷移
4. 間違っていればログイン失敗として下記メッセージを表示してログイン画面に遷移
    * IDかパスワードが間違っています。
### 新規登録ボタン
1. 新規登録画面に遷移
# 新規登録画面
## 画面項目
* メールアドレス入力欄（テキストボックス、必須）
* 名前入力欄（テキストボックス、必須）
* パスワード入力欄（パスワード入力ボックス、必須）
* パスワード確認入力欄（パスワード入力ボックス、必須）
* 登録ボタン
* 戻るボタン
## 処理
### 登録ボタン
1. ボタン押下後、入力内容をServerにリクエスト
2. バリデーションチェック後、memberテーブルの情報と突合
3. 既に登録されているメールアドレスなら新規登録画面に遷移
4. 登録されていないメールアドレスならパスワードを暗号化
5. memberテーブルに入力情報をInsert
6. 下記メッセージを渡して曲一覧画面に遷移
    * 新規登録しました。ようこそ！
# マイページ画面
## 画面項目
* メールアドレス（変更不可）
* 名前入力欄（テキストボックス、必須）
* パスワード入力欄（パスワード入力ボックス、必須）
* パスワード確認欄（パスワード入力ボックス、必須）
* 変更ボタン
* 戻るボタン
## 処理
### 変更ボタン
1. ボタン押下後、入力内容をServerにリクエスト
2. バリデーションチェック後、memberテーブルの情報と突合
3. 登録されていないメールアドレスならマイページ画面に遷移
4. 登録されているならパスワードを暗号化
5. 2で取得したmemberのIDを条件にmemberテーブルの名前、パスワードをUpdate
6. 下記メッセージを渡して曲一覧画面に遷移
    * メンバー情報を変更しました。
### 戻るボタン
1. 曲一覧画面に遷移
# 曲一覧画面
## 画面項目
* ヘッダー
    * マイページボタン
    * ログアウトボタン
* 検索
    * 曲名（テキストボックス、任意）
    * 作曲者（テキストボックス、任意）
    * 検索ボタン
* 曲一覧
    * 曲名（変更不可）
    * 作曲者（変更不可）
    * 説明（変更不可）
    * BPM（変更不可）
    * 拍子（変更不可）
    * 詳細ボタン
## 処理
### 初期表示
1. songsテーブルから情報を取得
2. songs.creater_idからmember.member_nameを取得
3. songs.beat_idからbeat.nameを取得
4. 各画面から遷移してメッセージがある場合はメッセージを画面に渡す
5. 画面表示
### マイページボタン
1. ボタン押下後、入力内容をServerにリクエスト
2. member_idをもとにmemberテーブルから情報を取得
3. マイページ画面に遷移
### マイページボタン
1. ボタン押下後、入力内容をServerにリクエスト
2. ログアウトを実施
### 検索ボタン
1. ボタン押下後、入力内容をServerにリクエスト
2. 入力された内容をもとにsongsテーブルから情報を取得
3. 検索結果を画面表示
### 詳細ボタン
1. 曲IDを渡して曲詳細画面に遷移
# 曲詳細画面
## 画面項目
* 曲名（変更不可）
* 作曲者（変更不可）
* 説明（変更不可）
* BPM（変更不可）
* 拍子（変更不可）
* 曲構成
    * 構成種別（変更不可）
        * コード（変更不可）
        * 小節数（変更不可）
* 再生ボタン
* 演奏
    * 楽器（変更不可）
        * ラジオボタン
        * 演奏タイトル（変更不可）
        * 説明（変更不可）
        * 演奏者名（変更不可）
        * 演奏ファイル（音声プレイヤー、変更不可）
* 演奏投稿ボタン
* コピーして新規作成ボタン
* 戻るボタン
## 処理
### 初期表示
1. 曲IDからsongsテーブルを取得
2. songs.creater_idからmember.member_nameを取得
3. songs.beat_idからbeat.nameを取得
4. 曲IDからsong_song_structureテーブルを取得
5. 曲IDからchord_progressionテーブルを取得
6. 曲IDからsong_playテーブルを取得
7. song_playを楽器種別ごとに分ける
8. song_play.player_idからmember_nameを取得
9. 画面表示
### 再生ボタン
1. jQuery、Web Audio APIで処理を行う
2. ラジオボタンで押下されている楽器の演奏を一斉再生する
### 演奏投稿ボタン
1. 曲IDを渡して演奏投稿画面に遷移
### コピーして新規作成ボタン
1. 画面の入力値を引き継いで曲投稿画面に遷移
### 戻るボタン
1. 曲一覧画面に遷移
# 曲投稿画面
## 画面項目
* 曲名入力欄（テキストボックス、必須）
* 説明入力欄（テキストボックス、必須）
* BPM入力欄（テキストボックス・半角数字のみ、必須）
* 拍子入力欄（プルダウン、必須）
* 曲の構成は上から下の順番で流れるものとします（固定文言）
* コード進行は左から右に流れるものとします（固定文言）
* 曲構成追加ボタン
* 曲構成
    * 構成コピーボタン
    * 構成種別入力欄（プルダウン、必須）
        * コード進行追加ボタン
        * コード入力欄（テキストボックス、必須）
        * 小節数入力欄（テキストボックス・半角数字のみ、必須）
        * コード削除ボタン
    * 構成削除ボタン
* 投稿ボタン
* 戻るボタン
## 処理
### 初期表示
1. beatテーブルから拍子を取得
2. sectionsテーブルから曲構成の種別を取得
3. コピーして新規作成ボタンから来た場合はリクエストから画面項目を作成
4. 画面表示
### 曲構成追加ボタン
1. jQueryで処理を行う
2. 曲構成の行（下記項目）を画面上に1行追加する
    * 構成コピーボタン構成種別入力欄
    * コード進行追加ボタン
    * コード入力欄
    * 小節数入力欄
    * コード削除ボタン
    * コード削除ボタン
3. コード進行
### 曲構成のドラッグ＆ドロップ
1. jQueryで処理を行う
2. 曲構成の順番を上下のみ入れ替える
### 構成コピーボタン
1. jQueryで処理を行う
2. 押下された構成コピーボタンに該当する曲構成をコピーして下の行に追加する
### コード進行追加ボタン
1. jQueryで処理を行う
2. コード入力欄、小節数入力欄、コード削除ボタンを既存のコード進行の右に1つ追加する
### コード進行のドラッグ＆ドロップ
1. jQueryで処理を行う
2. コード進行の順番を左右のみ入れ替える
### コード削除ボタン
1. jQueryで処理を行う
2. 押下されたコード削除ボタンに該当するコード進行を削除する
### 構成削除ボタン
1. jQueryで処理を行う
2. 押下された構成削除ボタンに該当する曲構成を削除する
### 投稿ボタン
1. ボタン押下後、画面上で曲の構成が最低１つある事を確認する
2. 画面上でコードと小節数が最低１つあることを確認する
3. 下記の確認メッセージを表示する
    * 一度投稿した曲は削除・変更ができません。よろしいですか？
4. OKを押下されたら入力内容をServerにリクエスト
5. バリデーションチェック後、画面上で入力されていた曲構成を上から順番にsong_structure.sort_orderとして値を振る
6. 同様に画面上で入力されていたコード進行を曲の構成毎に左から順番にchord_progression.sort_orderとして値を振る
7. songテーブルにInsertする
8. song_structureテーブルにInsertする
9. chord_progressionテーブルにInsertする
### 戻るボタン
# 演奏投稿画面
## 画面項目
* 曲名（固定文言）
* 演奏開始は１小節分の無音を入れてください※スライドなどで早めに入る場合はその限りではない（固定文言）
* 楽器入力欄（プルダウン、必須）
* 演奏タイトル入力欄（テキストボックス）
* 説明入力欄（テキストボックス）
* 演奏ファイル入力欄（ファイル選択）
* 演奏ファイルはmp3ファイルのみ（固定文言）
* 投稿ボタン
* 戻るボタン
## 処理
### 初期表示
1. 曲IDからsongsテーブルの情報を取得
2. instrumentsテーブルから楽器一覧を取得
3. 演奏投稿画面を表示
### 投稿ボタン
1. ボタン押下後、入力内容をServerにリクエスト
2. バリデーションチェック後、song_playテーブルにInsert
3. 曲詳細画面に遷移
### 戻るボタン
1. 曲詳細画面に遷移
